\ProvidesPackage{ustj}

\usepackage[T1]{fontenc}
%\usepackage[utf8]{inputenc}

\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{calc} % for \heightof in \tombstone

\usepackage{mathspec}
\setmainfont{Linux Libertine O}
\newfontfamily\monofont{Urbit Sans Mono TT SemiBold}[Scale=MatchLowercase]
\renewcommand{\setmonofont}{\monofont}
\renewcommand{\texttt}[1]{{\monofont #1}}
% Set the monospace font for math mode
%\usepackage{mathspec}
\setmathtt[Scale=MatchLowercase]{Urbit Sans Mono TT SemiBold}

\usepackage{listings}
\usepackage[dvipsnames]{xcolor}
\lstdefinelanguage{Hoon}
{
  alsoletter={
    ~!@\#\$\%^&*-_=+:;<>\,.?/|`"'\\
  },
  keywords={
    |_, |\%, |@, |:, |., |-, |^, |~, |*, |=, |?, |\$,
    \$@, \$_, \$:, \$\%, \$<, \$>, \$|, \$\&, \$^, \$~, \$-, \$=, \$?, \$;,
    \%_, \%., \%^, \%+, \%-, \%:, \%~, \%*, \%=,
    :_, :^, :+, :-, :~, :*,
    .+, .*, .=, .?, .^,
    --, ==,
    ^|, ^., ^-, ^+, ^\&, ^~, ^=, ^?, ^*, ^:,
    ~|, ~\$, ~_, ~\%, ~/, ~<, ~>, ~+, ~\&, ~?, ~=, ~!,
    ;:, ;/, ;<, ;~, ;;, ;+, ;*, ;=,
    =|, =., =?, =^, =:, =/, =;, =<, =>, =-, =*, =\,, =+, =~,
    ?|, ?:, ?., ?<, ?>, ?-, ?^, ?=, ?\#, ?+, ?\&, ?@, ?~, ?!,
    !:, !., !\,, !;, !>, !<, !@, !=, !?, !!,
    /?, /-, /+, /=, /\%, /\$, /*,
    +|, +\$, ++, +*,
  },
  morekeywords={
    @, @c, @d, @da, @dr, @f, @i, @if, @is, @n, @p, @q, @r, @rh, @rs, @rd, @rq, @s, @sb, @sd, @sv, @sw, @sx, @t, @ta, @tas, @u, @ub, @uc, @ud, @uv, @uw, @ux
    unit, cord, arch, tape, list, map, set
  },
  sensitive=true,
  morecomment=[l]{::},
  morestring=[b]",
  morestring=[d]'
}
\lstdefinestyle{inlinecode}{
    language=Hoon,
    basicstyle=\setmonofont,
    tabsize=2,
    columns=fixed,
    showstringspaces=false,
    showtabs=false,
    showspaces=false,
    keepspaces,
    upquote=true,
    breaklines=true,
    breakatwhitespace=true,
    commentstyle=\color{Gray}\emph,
    keywordstyle=\color{darkgray}\bfseries
}
\lstdefinestyle{listingcode}{
    language=Hoon,
    basicstyle=\setmonofont\small,
    numbers=left, numberstyle=\tiny, stepnumber=5, firstnumber=1, numberfirstline=false,
    frame=tb,
    tabsize=2,
    columns=fixed,
    showstringspaces=false,
    showtabs=false,
    showspaces=false,
    keepspaces,
    upquote=true,
    commentstyle=\color{Gray}\emph,
    keywordstyle=\color{darkgray}\bfseries
}
\lstdefinestyle{listingcode_python}{
    language=Python,
    basicstyle=\setmonofont\small,
    numbers=left, numberstyle=\tiny, stepnumber=5, firstnumber=1, numberfirstline=false,
    frame=tb,
    tabsize=2,
    columns=fixed,
    showstringspaces=false,
    showtabs=false,
    showspaces=false,
    keepspaces,
    upquote=true,
    commentstyle=\color{Gray}\emph,
    keywordstyle=\color{darkgray}\bfseries
}
\lstdefinestyle{listingcode_c}{
    language=C,
    basicstyle=\setmonofont\small,
    numbers=left, numberstyle=\tiny, stepnumber=5, firstnumber=1, numberfirstline=false,
    frame=tb,
    tabsize=2,
    columns=fixed,
    showstringspaces=false,
    showtabs=false,
    showspaces=false,
    keepspaces,
    upquote=true,
    commentstyle=\color{Gray}\emph,
    keywordstyle=\color{darkgray}\bfseries
}


\usepackage{titlesec}
\newfontfamily\urbitfont{Urbit Sans TT SemiBold}
\titleformat{\section}{\urbitfont\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\urbitfont\Large\bfseries}{\thesubsection}{1em}{}
\usepackage{titling}
\renewcommand{\maketitlehooka}{\urbitfont\bfseries}
% Redefine the format of the abstract heading to make it invisible
\AtBeginDocument{\renewcommand{\abstractname}{}}

%% Page size
\usepackage[paperheight=8.5in,paperwidth=5.5in,margin=1in,heightrounded,showframe]{geometry}

%% Configure first-page footer and later-page header.
\usepackage{fancyhdr}

\setlength{\headheight}{15.2pt}
\pagestyle{fancy}

\newcommand{\patp}[1]{\texttt{\textasciitilde#1}}
\newcommand{\github}[1]{\texttt{@#1}}

% Turn off when producing release version.
\usepackage{lineno}
\linenumbers

% Bibliography management
\usepackage[
    backend=biber,
    style=authoryear-icomp,
    sortlocale=en_US,
    natbib=true,
    url=false,
    eprint=false
]{biblatex}
\usepackage[hidelinks]{hyperref}
%\usepackage{natbib}
% \usepackage[hyphens]{url}
% Define a custom citation command for GitHub PRs
\DeclareCiteCommand{\citetpr}
  {\usebibmacro{prenote}}
  {\usebibmacro{citeindex}%
   \printtext[bibhyperref]{\printfield{usera}}}
  {\multicitedelim}
  {\usebibmacro{postnote}}

% Define a custom citation command for GitHub PRs
\DeclareCiteCommand{\citetrepo}
{\usebibmacro{prenote}}
{\usebibmacro{citeindex}%
 \printtext[bibhyperref]{\printfield{usera}}}
{\multicitedelim}
{\usebibmacro{postnote}}

% Define the custom citation command for @online entries
\DeclareCiteCommand{\customonlinecite}
  {\usebibmacro{prenote}}
  {\printnames{author}%
   \setunit{\addcomma\space}%
   \printfield{title}%
   \setunit{\addcomma\space}%
   (\printfield{year}).\space
   \printfield{titleaddon}%
   \setunit{\addperiod\space\textsc{url}\addcolon\space}%
   \texttt{\url{\thefield{url}}}%
   \setunit{\addspace(visited on\space}%
   \printdate% Print the access date
   \setunit{\addcomma\space}\bibstring{urlseen}\addperiod\space}%
  {\multicitedelim}
  {\usebibmacro{postnote}}

% Use the custom citation command for @online entries
\DeclareFieldFormat[online]{titleaddon}{#1} % Adjust the formatting of titleaddon
\DeclareBibliographyDriver{online}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \usebibmacro{author/editor}%
  \setunit{\addspace}%
  \usebibmacro{title}%
  \newunit\newblock
  \printfield{titleaddon}% Print titleaddon
  \newunit\newblock
  \usebibmacro{url+urldate}%
  \newunit\newblock
  \iftoggle{bbx:related}
    {\usebibmacro{related:init}%
     \usebibmacro{related}}
    {}%
  \usebibmacro{finentry}}

% Define the custom citation command for @software entries
\DeclareBibliographyDriver{software}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \usebibmacro{author/editor}%
  \setunit{\addspace}%
  \usebibmacro{title}%
  \newunit\newblock
  \usebibmacro{url+urldate}%
  \newunit\newblock
  \iftoggle{bbx:related}
    {\usebibmacro{related:init}%
     \usebibmacro{related}}
    {}%
  \usebibmacro{finentry}}

\newcommand{\tombstone}{\resizebox{!}{\heightof{T}}{\includegraphics{ustj-logo}}}
